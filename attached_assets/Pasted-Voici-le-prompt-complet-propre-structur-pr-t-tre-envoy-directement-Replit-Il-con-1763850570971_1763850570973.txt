Voici **le prompt complet, propre, structurÃ©**, prÃªt Ã  Ãªtre envoyÃ© **directement Ã  Replit**.
Il contient **toutes les corrections nÃ©cessaires**, aucune ambiguÃ¯tÃ©, et entiÃ¨rement actionnable.

---

# âœ… **PROMPT FINAL Ã€ ENVOYER Ã€ REPLIT**

Corrige tout ce qui suit dans mon projet. Voici les instructions techniques exactes Ã  appliquer :

---

# 1ï¸âƒ£ **CORRECTION â€” Messages.tsx (notifications qui disparaissent trop vite)**

Dans le fichier :
`client/src/pages/Messages.tsx`

Trouve le code suivant dans `handleToggleExpand` :

```ts
if (!message.isRead) {
  markAsReadMutation.mutate(messageId);
}
```

Remplace-le par :

```ts
if (!message.isRead) {
  // Retarde la lecture de 30 secondes
  setTimeout(() => {
    markAsReadMutation.mutate(messageId);
  }, 30000);
}
```

ğŸ¯ Objectif :
Les notifications restent visibles **30 secondes** avant d'Ãªtre marquÃ©es comme lues.

---

# 2ï¸âƒ£ **CORRECTION â€” useChat.ts (statut en ligne ne fonctionne pas)**

Dans le fichier
`client/src/hooks/useChat.ts`

Ajoute la ligne suivante juste aprÃ¨s :

```ts
socket.on("connect", () => {
```

ğŸ‘‡ Ajouter :

```ts
socket.emit("auth", { userId });
```

Le bloc complet doit devenir :

```ts
socket.on("connect", () => {
  console.log("[CHAT] Connected to Socket.IO");
  setIsSelfConnected(true);

  // Identifie lâ€™utilisateur auprÃ¨s du backend
  socket.emit("auth", { userId });

  socket.emit("join_room", room);
  socket.emit("join_room", `user_${userId}`);

  if (partnerId) {
    socket.emit("get_presence_state", [partnerId]);
  }
});
```

ğŸ¯ Objectif :
Le backend doit savoir **quel utilisateur est connectÃ©**, ce qui active le systÃ¨me de prÃ©sence en ligne / hors-ligne.

---

# 3ï¸âƒ£ **CORRECTION BACKEND â€” socket.ts (nÃ©cessaire pour gÃ©rer la prÃ©sence)**

Dans le fichier :
`server/socket.ts`

Ajoute cet event si ce n'est pas encore prÃ©sent :

```ts
io.on("connection", (socket) => {
  socket.on("auth", ({ userId }) => {
    socket.userId = userId;
    presenceManager.addSocket(userId, socket.id);

    io.emit("user_presence", { userId, isOnline: true });
    console.log(`[PRESENCE] Authenticated user ${userId} is online`);
  });
});
```

ğŸ¯ Objectif :
Quand le frontend envoie `socket.emit("auth", { userId })`, le backend :

* enregistre le userId
* active la prÃ©sence en ligne
* broadcast lâ€™Ã©tat online/offline

---

# 4ï¸âƒ£ **Correction des messages automatiques multilingues**

Dans :
`server/notification-helper.ts`

Les notifications ont :

```ts
title: '',
message: '',
```

â¡ï¸ **Laisse-les vides.**
Ne remplis rien.
Câ€™est normal.
Le frontend utilise automatiquement :
`t.notifications[type].title`
`t.notifications[type].message`

ğŸ¯ Objectif :
Le multilingue est gÃ©nÃ©rÃ© dans le frontend via i18n.

---

# 5ï¸âƒ£ **Assure-toi que toutes les mutations `markAsRead` sont bien expliquÃ©es**

Aucun autre changement nâ€™est nÃ©cessaire.

---

# âœ”ï¸ RÃ©sultat attendu aprÃ¨s corrections

* Les notifications ne disparaissent plus instantanÃ©ment â†’ **30 secondes avant lecture**
* Les notifications automatiques deviennent **multilingues**
* Le chat affiche enfin correctement **En ligne / Hors ligne**
* La prÃ©sence en temps rÃ©el fonctionne
* Lâ€™utilisateur peut envoyer et recevoir des messages normalement
* Le backend reconnaÃ®t correctement lâ€™utilisateur via Socket.IO

---

ğŸ‘‰ **ExÃ©cute exactement ces modifications et confirme quand câ€™est appliquÃ©.**

---

Fin du prompt.
